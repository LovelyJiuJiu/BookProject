<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.boku.mapper.BookMapper">
  <resultMap id="BaseResultMap" type="com.boku.pojo.Book">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="bookname" jdbcType="VARCHAR" property="bookname" />
    <result column="type_id" jdbcType="INTEGER" property="typeId" />
    <result column="book_author" jdbcType="VARCHAR" property="bookAuthor" />
    <result column="book_introduction" jdbcType="VARCHAR" property="bookIntroduction" />
    <result column="book_publisher" jdbcType="VARCHAR" property="bookPublisher" />
    <result column="book_image" jdbcType="VARCHAR" property="bookImage" />
    <result column="book_price" jdbcType="DOUBLE" property="bookPrice" />
    <result column="status" jdbcType="INTEGER" property="status" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="last_update_time" jdbcType="TIMESTAMP" property="lastUpdateTime" />
	<result column="book_qr" jdbcType="VARCHAR" property="bookQr" />
  </resultMap>
  
   <resultMap id="BookTypeCount" type="com.boku.pojo.BookTypeCount">
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="bookname" jdbcType="VARCHAR" property="bookname" />
    <result column="type_id" jdbcType="INTEGER" property="typeId" />
    <result column="book_author" jdbcType="VARCHAR" property="bookAuthor" />
    <result column="book_image" jdbcType="VARCHAR" property="bookImage" />
    <result column="book_price" jdbcType="DOUBLE" property="bookPrice" />
    <result column="typename" jdbcType="VARCHAR" property="typename" />
	<result column="purchasecount" jdbcType="INTEGER" property="purchaseCount" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, bookname, type_id, book_author, book_introduction, book_publisher, book_image, 
    book_price, status, create_time, last_update_time,book_qr
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from book
    where id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from book
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.boku.pojo.Book">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into book (id, bookname, type_id, 
      book_author, book_introduction, book_publisher, 
      book_image, book_price, status, 
      create_time, last_update_time,book_qr)
    values (#{id,jdbcType=INTEGER}, #{bookname,jdbcType=VARCHAR}, #{typeId,jdbcType=INTEGER}, 
      #{bookAuthor,jdbcType=VARCHAR}, #{bookIntroduction,jdbcType=VARCHAR}, #{bookPublisher,jdbcType=VARCHAR}, 
      #{bookImage,jdbcType=VARCHAR}, #{bookPrice,jdbcType=DOUBLE}, #{status,jdbcType=INTEGER}, 
      #{createTime,jdbcType=TIMESTAMP}, #{lastUpdateTime,jdbcType=TIMESTAMP},#{bookQr,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.boku.pojo.Book">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into book
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="bookname != null">
        bookname,
      </if>
      <if test="typeId != null">
        type_id,
      </if>
      <if test="bookAuthor != null">
        book_author,
      </if>
      <if test="bookIntroduction != null">
        book_introduction,
      </if>
      <if test="bookPublisher != null">
        book_publisher,
      </if>
      <if test="bookImage != null">
        book_image,
      </if>
      <if test="bookPrice != null">
        book_price,
      </if>
      <if test="status != null">
        status,
      </if>
      <if test="createTime != null">
        create_time,
      </if>
      <if test="lastUpdateTime != null">
        last_update_time,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=INTEGER},
      </if>
      <if test="bookname != null">
        #{bookname,jdbcType=VARCHAR},
      </if>
      <if test="typeId != null">
        #{typeId,jdbcType=INTEGER},
      </if>
      <if test="bookAuthor != null">
        #{bookAuthor,jdbcType=VARCHAR},
      </if>
      <if test="bookIntroduction != null">
        #{bookIntroduction,jdbcType=VARCHAR},
      </if>
      <if test="bookPublisher != null">
        #{bookPublisher,jdbcType=VARCHAR},
      </if>
      <if test="bookImage != null">
        #{bookImage,jdbcType=VARCHAR},
      </if>
      <if test="bookPrice != null">
        #{bookPrice,jdbcType=DOUBLE},
      </if>
      <if test="status != null">
        #{status,jdbcType=INTEGER},
      </if>
      <if test="createTime != null">
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="lastUpdateTime != null">
        #{lastUpdateTime,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.boku.pojo.Book">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update book
    <set>
      <if test="bookname != null">
        bookname = #{bookname,jdbcType=VARCHAR},
      </if>
      <if test="typeId != null">
        type_id = #{typeId,jdbcType=INTEGER},
      </if>
      <if test="bookAuthor != null">
        book_author = #{bookAuthor,jdbcType=VARCHAR},
      </if>
      <if test="bookIntroduction != null">
        book_introduction = #{bookIntroduction,jdbcType=VARCHAR},
      </if>
      <if test="bookPublisher != null">
        book_publisher = #{bookPublisher,jdbcType=VARCHAR},
      </if>
      <if test="bookImage != null">
        book_image = #{bookImage,jdbcType=VARCHAR},
      </if>
      <if test="bookPrice != null">
        book_price = #{bookPrice,jdbcType=DOUBLE},
      </if>
      <if test="status != null">
        status = #{status,jdbcType=INTEGER},
      </if>
      <if test="createTime != null">
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="lastUpdateTime != null">
        last_update_time = #{lastUpdateTime,jdbcType=TIMESTAMP},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.boku.pojo.Book">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update book
    set bookname = #{bookname,jdbcType=VARCHAR},
      type_id = #{typeId,jdbcType=INTEGER},
      book_author = #{bookAuthor,jdbcType=VARCHAR},
      book_introduction = #{bookIntroduction,jdbcType=VARCHAR},
      book_publisher = #{bookPublisher,jdbcType=VARCHAR},
      book_image = #{bookImage,jdbcType=VARCHAR},
      book_price = #{bookPrice,jdbcType=DOUBLE},
      status = #{status,jdbcType=INTEGER},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      last_update_time = #{lastUpdateTime,jdbcType=TIMESTAMP}
    where id = #{id,jdbcType=INTEGER}
  </update>
  
  <select id="getBookListByIds" resultMap="BaseResultMap">
    select *
    from book
    <where>
    id IN
    <foreach item="bookId" index="index" collection="list"
        open="(" separator="," close=")"> #{bookId,jdbcType=INTEGER}
    </foreach>
	</where>
  </select>
  
  <select id="getBookList" resultMap="BaseResultMap">
    select 
    <include refid="Base_Column_List" />
    from book
  </select>

  <select id="selectBookByKeywords" resultMap="BaseResultMap">
    select *
    from book 
    where bookname like concat('%', #{keyWords}, '%') and status = 0
    <if test="symbol == null">
		limit 0, 5
	</if>		 
  </select>
  
  <select id="getNewBookList" resultMap="BaseResultMap">
    select *
    from book where status = 0
    ORDER BY create_time DESC
	limit 0, 5		 
  </select>
  
  <select id="getHotBookList" resultMap="BaseResultMap">
	select book.id,book.bookname,book.book_author,book.book_image,book.book_introduction
	from book, count 
	where book.id=count.book_id and book.status = 0
	ORDER BY count.purchasecount DESC
	limit 0, 5		 
  </select>
  
    <select id="getHotBookAndCountList" resultMap="BookTypeCount">
		select * from book,count,type
		where book.id=count.book_id and book.type_id =type.id and book.status = 0 and count.purchasecount > 0
		order by count.purchasecount DESC
		LIMIT 0,10	 
  </select>
  
  
</mapper>